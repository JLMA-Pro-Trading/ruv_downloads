[package]
name = "bitchat-qudag"
version = "0.1.0"
edition = "2021"
description = "BitChat messaging integration for QuDAG with WASM support"
authors = ["rUv <https://github.com/ruvnet>"]
license = "MIT OR Apache-2.0"
repository = "https://github.com/ruvnet/QuDAG"
homepage = "https://github.com/ruvnet/QuDAG/tree/main/bitchat-qudag-crate"
documentation = "https://docs.rs/bitchat-qudag"
readme = "README.md"
keywords = ["messaging", "p2p", "crypto", "wasm", "qudag"]
categories = ["network-programming", "cryptography", "web-programming", "wasm"]

[lib]
crate-type = ["cdylib", "rlib"]

[dependencies]
# Core async and utilities
tokio = { workspace = true, optional = true }
async-trait = { workspace = true }
futures = { workspace = true }
uuid = { workspace = true }
chrono = { version = "0.4", features = ["serde"] }

# Serialization
serde = { workspace = true }
serde_json = { workspace = true }
bincode = { workspace = true }

# Error handling and logging
thiserror = { workspace = true }
tracing = { workspace = true }

# Cryptography
chacha20poly1305 = "0.10"
x25519-dalek = "2.0"
ed25519-dalek = "2.0"
aes-gcm = "0.10"
rand = { workspace = true }
blake3 = { workspace = true }
argon2 = "0.5"

# Quantum-resistant cryptography
oqs = "0.7"
snow = "0.9"
zeroize = "1.6"
hkdf = "0.12"
hmac = "0.12"
sha2 = "0.10"

# Additional dependencies
hex = { workspace = true }
base64 = "0.21"
tracing-subscriber = { version = "0.3", optional = true }
console_error_panic_hook = { version = "0.1", optional = true }
tracing-wasm = { version = "0.2", optional = true }

# Compression
lz4 = { version = "1.24", optional = true }
zstd = { version = "0.13", optional = true }

# Messaging-specific dependencies
rocksdb = { version = "0.22", optional = true }
bloom = { version = "0.3", optional = true }

# Networking (non-WASM)
libp2p = { version = "0.53", features = ["gossipsub", "identify", "noise", "ping", "tcp", "websocket", "yamux", "tokio", "macros", "dns"], optional = true }
tokio-tungstenite = { version = "0.21", optional = true }

# WASM-specific dependencies
wasm-bindgen = { workspace = true, optional = true }
wasm-bindgen-futures = { workspace = true, optional = true }
js-sys = { workspace = true, optional = true }
web-sys = { workspace = true, features = [
  "console",
  "WebSocket",
  "MessageEvent",
  "CloseEvent",
  "ErrorEvent",
  "BinaryType",
  "Window",
  "Document",
  "Element",
  "EventTarget",
  "Event",
], optional = true }
getrandom = { version = "0.2", features = ["js"] }

# Optional features
parking_lot = { workspace = true, optional = true }

[dev-dependencies]
tokio-test = { workspace = true }
tempfile = "3.0"
criterion = { workspace = true }
wasm-bindgen-test = "0.3"
proptest = "1.2"
test-case = "3.1"
mockall = "0.11"

[features]
default = ["tokio", "compression", "encryption"]

# Core features
tokio = ["dep:tokio", "parking_lot"]
compression = ["lz4", "zstd"]
encryption = []
networking = ["libp2p", "tokio-tungstenite"]
messaging = ["rocksdb", "bloom"]

# Transport features
bluetooth = ["btleplug"]
websocket = []
local-discovery = []
relay = ["stun", "igd"]

# Privacy features
cover-traffic = []
store-forward = []
ephemeral-messages = []

# WASM features
wasm = [
  "wasm-bindgen",
  "wasm-bindgen-futures", 
  "js-sys",
  "web-sys",
  "websocket"
]

# Platform-specific features
native = ["tokio", "networking", "bluetooth", "local-discovery", "relay"]
web = ["wasm", "websocket"]

# Development features
full = [
  "tokio",
  "compression",
  "encryption",
  "networking",
  "bluetooth",
  "websocket",
  "local-discovery",
  "relay",
  "cover-traffic",
  "store-forward",
  "ephemeral-messages",
  "messaging"
]

[target.'cfg(not(target_arch = "wasm32"))'.dependencies]
tokio = { workspace = true }
libp2p = { version = "0.53", features = ["gossipsub", "identify", "noise", "ping", "tcp", "websocket", "yamux", "tokio", "macros", "dns", "mdns", "kad", "request-response", "relay", "dcutr", "rendezvous", "upnp"] }
parking_lot = { workspace = true }
btleplug = { version = "0.11", optional = true }
mdns = "3.0"
if-watch = "3.0"
# webrtc = { version = "0.4", optional = true } # Disabled due to version conflicts
stun = { version = "0.6", optional = true }
igd = { version = "0.12", optional = true }
local-ip-address = "0.5"
num_cpus = "1.16"
hostname = "0.3"
sysinfo = "0.30"

[target.'cfg(target_arch = "wasm32")'.dependencies]
wasm-bindgen = { workspace = true }
wasm-bindgen-futures = { workspace = true }
js-sys = { workspace = true }
web-sys = { workspace = true, features = [
  "console", "WebSocket", "MessageEvent", "CloseEvent", "ErrorEvent",
  "BinaryType", "Window", "Document", "Element", "EventTarget", "Event"
] }
getrandom = { version = "0.2", features = ["js"] }

# Examples will be added after core implementation is complete

[package.metadata.docs.rs]
all-features = true
rustdoc-args = ["--cfg", "docsrs"]

[package.metadata.wasm-pack.profile.release]
wasm-opt = ["-O4", "--enable-simd"]