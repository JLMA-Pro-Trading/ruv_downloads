{"version":3,"sources":["../../src/cli/commands/import.ts"],"names":[],"mappings":"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","file":"import.js","sourcesContent":["import { Command } from 'commander';\nimport chalk from 'chalk';\nimport ora from 'ora';\nimport { readFile, writeFile, mkdir } from 'fs/promises';\nimport { resolve } from 'path';\nimport { existsSync } from 'fs';\nimport { homedir } from 'os';\n\ninterface ClaudeConfig {\n  mcpServers?: string[];\n  [key: string]: any;\n}\n\ninterface SkillMetadata {\n  name: string;\n  type: 'mcp';\n  source: 'claude-desktop';\n  enabled: boolean;\n  importedAt: string;\n}\n\nexport const importCommand = new Command('import')\n  .description('Import MCP servers from Claude Desktop settings as skills')\n  .option('--backup', 'Create backup of existing skills directory')\n  .option('--disable-global', 'Remove from global Claude settings after import')\n  .option('--dry-run', 'Show what would be imported without making changes')\n  .option('-s, --source <path>', 'Path to Claude settings.json')\n  .option('-o, --output <path>', 'Output skills directory', './skills')\n  .action(async (options) => {\n    const spinner = ora('Importing MCP servers from Claude Desktop...').start();\n\n    try {\n      // Determine Claude settings path\n      const sourcePath = options.source || getClaudeSettingsPath();\n\n      if (!existsSync(sourcePath)) {\n        spinner.fail('Claude Desktop settings not found');\n        console.log(chalk.yellow(`\\nExpected location: ${sourcePath}`));\n        console.log(chalk.gray('Use --source to specify a different path'));\n        process.exit(1);\n      }\n\n      spinner.text = 'Reading Claude Desktop settings...';\n      const claudeConfig = await readClaudeConfig(sourcePath);\n\n      if (!claudeConfig.mcpServers || claudeConfig.mcpServers.length === 0) {\n        spinner.warn('No MCP servers found in Claude Desktop settings');\n        process.exit(0);\n      }\n\n      const outputPath = resolve(options.output);\n\n      // Backup existing skills if requested\n      if (options.backup && existsSync(outputPath)) {\n        spinner.text = 'Creating backup...';\n        const backupPath = `${outputPath}.backup.${Date.now()}`;\n        await mkdir(backupPath, { recursive: true });\n        // Copy existing skills (simplified for now)\n        console.log(chalk.gray(`  Backup would be created at: ${backupPath}`));\n      }\n\n      // Create skills directory\n      await mkdir(outputPath, { recursive: true });\n\n      spinner.text = 'Generating skill files...';\n\n      const importedSkills: SkillMetadata[] = [];\n\n      for (const serverName of claudeConfig.mcpServers) {\n        if (options.dryRun) {\n          console.log(chalk.gray(`  Would import: ${serverName}`));\n          continue;\n        }\n\n        const skillFile = await generateSkillFile(serverName);\n        const skillPath = resolve(outputPath, `${serverName}.md`);\n\n        await writeFile(skillPath, skillFile, 'utf-8');\n\n        importedSkills.push({\n          name: serverName,\n          type: 'mcp',\n          source: 'claude-desktop',\n          enabled: true,\n          importedAt: new Date().toISOString()\n        });\n      }\n\n      if (!options.dryRun) {\n        // Update INDEX.md\n        spinner.text = 'Updating INDEX.md...';\n        await updateIndexFile(outputPath, importedSkills);\n\n        // Update CLAUDE.md\n        spinner.text = 'Updating CLAUDE.md...';\n        await updateClaudeFile(outputPath, importedSkills);\n\n        // Remove from global settings if requested\n        if (options.disableGlobal) {\n          spinner.text = 'Removing from global Claude settings...';\n          await removeFromGlobalSettings(sourcePath, importedSkills.map(s => s.name));\n        }\n      }\n\n      spinner.succeed(chalk.green('Import complete!'));\n\n      console.log(chalk.cyan(`\\nImported ${claudeConfig.mcpServers.length} MCP servers as skills:`));\n      claudeConfig.mcpServers.forEach((name: string) => {\n        console.log(chalk.gray(`  ✓ ${name}`));\n      });\n\n      console.log(chalk.cyan('\\nFiles created:'));\n      console.log(chalk.gray(`  ${outputPath}/`));\n      console.log(chalk.gray(`  ${outputPath}/INDEX.md`));\n      console.log(chalk.gray(`  ${outputPath}/CLAUDE.md`));\n\n      if (!options.dryRun && options.disableGlobal) {\n        console.log(chalk.yellow('\\n⚠️  MCP servers removed from global Claude settings'));\n        console.log(chalk.gray('  They are now available as project-local skills'));\n      }\n\n      console.log(chalk.cyan('\\nNext steps:'));\n      console.log(chalk.gray('  1. Review generated skill files'));\n      console.log(chalk.gray('  2. Run: ultrathink sync'));\n      console.log(chalk.gray('  3. Commit the skills directory to your repository'));\n\n    } catch (error) {\n      spinner.fail(chalk.red('Import failed'));\n      console.error(chalk.red('Error:'), error instanceof Error ? error.message : error);\n      if (options.parent?.opts().debug) {\n        console.error(error);\n      }\n      process.exit(1);\n    }\n  });\n\nfunction getClaudeSettingsPath(): string {\n  const home = homedir();\n  return resolve(home, '.claude/settings.json');\n}\n\nasync function readClaudeConfig(path: string): Promise<ClaudeConfig> {\n  const content = await readFile(path, 'utf-8');\n  return JSON.parse(content);\n}\n\nasync function generateSkillFile(serverName: string): Promise<string> {\n  const timestamp = new Date().toISOString();\n\n  return `---\nname: ${serverName}\ntype: mcp\nsource: claude-desktop\nenabled: true\nimported_at: ${timestamp}\n---\n\n# ${serverName} MCP Skill\n\n**Type:** MCP Server Integration\n**Source:** Imported from Claude Desktop\n**Status:** Active\n\n## Description\n\nThis skill provides access to the \\`${serverName}\\` MCP server capabilities.\n\nImported from global Claude Desktop configuration to enable:\n- Project-specific skill management\n- Version control of MCP configurations\n- Team collaboration on available tools\n- Granular enable/disable control\n\n## Usage\n\nThis MCP server is automatically available in Claude Code when this skill is active.\nAll tools from \\`${serverName}\\` can be invoked directly.\n\n## Configuration\n\nTo modify MCP server settings:\n1. Edit this skill file's frontmatter\n2. Run \\`ultrathink sync\\` to apply changes\n3. Restart Claude Code if needed\n\n## Notes\n\n- Imported: ${timestamp}\n- Original location: \\`~/.claude/settings.json\\`\n- This skill represents an MCP server integration\n`;\n}\n\nasync function updateIndexFile(skillsPath: string, skills: SkillMetadata[]): Promise<void> {\n  const indexPath = resolve(skillsPath, 'INDEX.md');\n\n  const content = `# Skills Index\n\n**Last Updated:** ${new Date().toISOString()}\n**Total Skills:** ${skills.length}\n\n## Available Skills\n\n${skills\n  .map(skill => `- **${skill.name}** (${skill.type}) - ${skill.enabled ? '✓ Enabled' : '✗ Disabled'}`)\n  .join('\\n')}\n\n## Quick Stats\n\n- **MCP Servers:** ${skills.filter(s => s.type === 'mcp').length}\n- **Active:** ${skills.filter(s => s.enabled).length}\n- **Inactive:** ${skills.filter(s => !s.enabled).length}\n\n## Management\n\n- \\`ultrathink import\\` - Import MCPs from Claude Desktop\n- \\`ultrathink sync\\` - Sync index with file changes\n- \\`ultrathink detect-mcp\\` - Detect available MCP servers\n\n---\n*Auto-generated by ultrathink*\n`;\n\n  await writeFile(indexPath, content, 'utf-8');\n}\n\nasync function updateClaudeFile(skillsPath: string, skills: SkillMetadata[]): Promise<void> {\n  const claudePath = resolve(skillsPath, 'CLAUDE.md');\n\n  const content = `# Claude Code Skills Configuration\n\nThis project uses **ultrathink auto-skills** for MCP management.\n\n## Available Skills\n\n${skills.map(skill => `- ${skill.name}`).join('\\n')}\n\n## How It Works\n\nSkills in this directory are automatically loaded when Claude Code starts in this project.\nEach skill file (\\`.md\\`) contains:\n\n- YAML frontmatter with configuration\n- Description and usage instructions\n- Project-specific settings\n\n## Commands\n\n\\`\\`\\`bash\n# Import MCPs from global Claude settings\nultrathink import\n\n# Sync index with file changes\nultrathink sync\n\n# Discover AI experts in codebase\nultrathink discover --project ./\n\n# Detect available MCP servers\nultrathink detect-mcp\n\n# Configure auto-invocation\nultrathink auto-invoke --config\n\\`\\`\\`\n\n## Benefits\n\n- ✓ Version controlled MCP configurations\n- ✓ Project-specific skill management\n- ✓ Team collaboration on tooling\n- ✓ Easy enable/disable per project\n- ✓ No global setting conflicts\n\n---\n*Managed by ultrathink*\n`;\n\n  await writeFile(claudePath, content, 'utf-8');\n}\n\nasync function removeFromGlobalSettings(settingsPath: string, serverNames: string[]): Promise<void> {\n  const config = await readClaudeConfig(settingsPath);\n\n  if (config.mcpServers) {\n    config.mcpServers = config.mcpServers.filter((name: string) => !serverNames.includes(name));\n  }\n\n  await writeFile(settingsPath, JSON.stringify(config, null, 2), 'utf-8');\n}\n"]}