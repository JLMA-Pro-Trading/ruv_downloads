{"version":3,"sources":["../../src/cli/commands/server.ts"],"names":["resolve"],"mappings":"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","file":"server.js","sourcesContent":["import { Command } from 'commander';\nimport chalk from 'chalk';\nimport ora from 'ora';\nimport { spawn } from 'child_process';\nimport { existsSync } from 'fs';\nimport { resolve } from 'path';\n\nexport const serverCommand = new Command('server')\n  .alias('serve')\n  .description('Start MCP server with generated wrappers')\n  .option('-p, --port <port>', 'Server port', '3000')\n  .option('-h, --host <host>', 'Server host', 'localhost')\n  .option('-c, --config <path>', 'Configuration file')\n  .option('-w, --watch', 'Watch mode for development')\n  .option('--stdio', 'Use stdio transport instead of HTTP')\n  .option('--sse', 'Use Server-Sent Events transport')\n  .action(async (options) => {\n    const spinner = ora('Starting MCP server...').start();\n\n    try {\n      // Load configuration\n      const configPath = options.config\n        ? resolve(options.config)\n        : resolve(process.cwd(), 'ultrathink.config.json');\n\n      if (!existsSync(configPath)) {\n        spinner.warn('No configuration file found, using defaults');\n      } else {\n        spinner.text = 'Loading configuration...';\n        // TODO: Load and validate config\n      }\n\n      // Determine transport mode\n      const transport = options.stdio ? 'stdio' : options.sse ? 'sse' : 'http';\n\n      spinner.text = `Starting ${transport.toUpperCase()} server...`;\n\n      if (transport === 'stdio') {\n        await startStdioServer(options);\n        spinner.succeed(chalk.green('STDIO server started'));\n      } else {\n        await startHttpServer(options);\n        spinner.succeed(chalk.green(`HTTP server started`));\n        console.log(chalk.cyan(`\\nServer running at: http://${options.host}:${options.port}`));\n      }\n\n      if (options.watch) {\n        console.log(chalk.yellow('\\nWatch mode enabled - server will restart on file changes'));\n      }\n\n      // Keep process alive\n      process.on('SIGINT', () => {\n        console.log(chalk.yellow('\\n\\nShutting down server...'));\n        process.exit(0);\n      });\n\n    } catch (error) {\n      spinner.fail(chalk.red('Server startup failed'));\n      console.error(chalk.red('Error:'), error instanceof Error ? error.message : error);\n      if (options.parent?.opts().debug) {\n        console.error(error);\n      }\n      process.exit(1);\n    }\n  });\n\nasync function startStdioServer(options: any): Promise<void> {\n  // TODO: Implement stdio server\n  console.log(chalk.gray('Listening on stdin/stdout...'));\n\n  process.stdin.on('data', (data) => {\n    try {\n      const message = JSON.parse(data.toString());\n      // Handle MCP protocol messages\n      handleMCPMessage(message);\n    } catch (error) {\n      console.error('Invalid JSON received');\n    }\n  });\n}\n\nasync function startHttpServer(options: any): Promise<void> {\n  // TODO: Implement HTTP server with proper MCP protocol\n  const { host, port } = options;\n\n  // For now, just simulate server startup\n  await new Promise(resolve => setTimeout(resolve, 500));\n\n  console.log(chalk.gray(`Listening on ${host}:${port}...`));\n}\n\nfunction handleMCPMessage(message: any): void {\n  // TODO: Implement MCP protocol message handling\n  const response = {\n    jsonrpc: '2.0',\n    id: message.id,\n    result: {\n      capabilities: {\n        tools: {}\n      }\n    }\n  };\n\n  process.stdout.write(JSON.stringify(response) + '\\n');\n}\n"]}