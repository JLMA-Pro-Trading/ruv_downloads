#!/usr/bin/env node
/**
 * Iris CLI - Unified entry point
 *
 * ESM-compatible entry point with MCP stdout suppression
 */

// CRITICAL: For MCP server mode, suppress ALL stdout before any imports
// MCP protocol requires stdout to contain ONLY JSON-RPC messages
const isMcpServer = process.argv.includes('mcp:server') || process.argv.includes('serve');
if (isMcpServer) {
  process.env.IRIS_MCP_MODE = 'true';
  const originalLog = console.log;
  console.log = (...args) => {
    // Only allow JSON through (MCP protocol messages)
    if (args.length === 1 && typeof args[0] === 'string' && args[0].startsWith('{')) {
      originalLog(...args);
    }
    // Redirect everything else to stderr (won't break MCP protocol)
    else {
      console.error('[iris]', ...args);
    }
  };
}

import('../dist/cli/iris-cli.js').catch((error) => {
  console.error('Failed to load Iris CLI:', error);
  process.exit(1);
});
